---
title: Database Setup
description: Configure SQLite or Turso database for Discord Forum API
---

import { Steps, Aside, Tabs, TabItem } from '@astrojs/starlight/components';

Discord Forum API supports multiple database backends. Choose based on your deployment needs.

## Database Options

| Database | Best For | Features |
|----------|----------|----------|
| **SQLite** | Development, small deployments | Zero config, file-based |
| **Turso** | Production, edge deployments | Multi-region, edge-compatible |
| **PostgreSQL** | High-scale deployments | Coming soon |

## SQLite (Default)

SQLite is the default database - perfect for development and small to medium deployments.

### Configuration

No configuration needed! The database file is created automatically at `./data/discord-forum.db`.

To customize the path:

```env
DATABASE_TYPE=sqlite
DATABASE_PATH=./data/my-custom-name.db
```

### Initialize Schema

Push the schema to create tables:

```bash
pnpm db:push
```

Or use migrations for production:

```bash
# Generate migration files
pnpm db:generate

# Run migrations
pnpm db:migrate
```

### SQLite Pros & Cons

**Advantages:**
- Zero configuration
- No external dependencies
- Fast for read-heavy workloads
- Easy to backup (just copy the file)

**Limitations:**
- Single writer at a time
- Not suitable for multi-instance deployments
- No built-in replication

<Aside>
  SQLite can handle thousands of threads and tens of thousands of messages without issues. Only consider Turso/PostgreSQL for very large deployments or when you need multi-region access.
</Aside>

## Turso

[Turso](https://turso.tech/) is a SQLite-compatible database optimized for edge deployments.

### Why Turso?

- **Edge-compatible**: Deploy data close to users globally
- **Free tier**: 500 databases, 9GB storage
- **Serverless**: No servers to manage
- **SQLite compatible**: Same queries, zero migration needed

### Setup

<Steps>

1. **Install Turso CLI**

   ```bash
   # macOS/Linux
   curl -sSfL https://get.tur.so/install.sh | bash

   # Windows (WSL)
   curl -sSfL https://get.tur.so/install.sh | bash
   ```

2. **Sign up and authenticate**

   ```bash
   turso auth signup
   # or
   turso auth login
   ```

3. **Create a database**

   ```bash
   turso db create discord-forum-api
   ```

4. **Get your database URL**

   ```bash
   turso db show discord-forum-api --url
   # Output: libsql://discord-forum-api-username.turso.io
   ```

5. **Create an auth token**

   ```bash
   turso db tokens create discord-forum-api
   # Output: eyJhbGci...
   ```

6. **Update `.env`**

   ```env
   DATABASE_TYPE=turso
   TURSO_DATABASE_URL=libsql://discord-forum-api-username.turso.io
   TURSO_AUTH_TOKEN=eyJhbGci...
   ```

7. **Push schema**

   ```bash
   pnpm db:push
   ```

</Steps>

### Turso CLI Commands

| Command | Description |
|---------|-------------|
| `turso db list` | List all databases |
| `turso db show <name>` | Show database details |
| `turso db shell <name>` | Interactive SQL shell |
| `turso db tokens create <name>` | Create auth token |
| `turso db destroy <name>` | Delete database |

### Turso Pricing

| Tier | Price | Includes |
|------|-------|----------|
| **Starter** | Free | 500 DBs, 9GB storage, 1B reads/month |
| **Scaler** | $29/mo | Unlimited DBs, 24GB storage, higher limits |
| **Enterprise** | Custom | SLA, dedicated support |

<Aside type="tip">
  The free tier is more than enough for most projects. You can monitor usage with `turso plan show`.
</Aside>

## Database Management

### Drizzle Studio

Open a visual database browser:

```bash
pnpm db:studio
```

This opens a web interface where you can:

- Browse tables
- View and edit data
- Run SQL queries
- Export data

### Schema Changes

When you modify the schema:

<Tabs>
  <TabItem label="Development">
    Push changes directly (fast, may lose data):

    ```bash
    pnpm db:push
    ```
  </TabItem>
  <TabItem label="Production">
    Use migrations (safe, preserves data):

    ```bash
    # Generate migration
    pnpm db:generate

    # Review the generated SQL in drizzle/

    # Apply migration
    pnpm db:migrate
    ```
  </TabItem>
</Tabs>

### Backup & Restore

#### SQLite

```bash
# Backup
cp ./data/discord-forum.db ./data/discord-forum.db.backup

# Restore
cp ./data/discord-forum.db.backup ./data/discord-forum.db
```

<Aside type="caution">
  Stop the bot before backing up SQLite to avoid corruption.
</Aside>

#### Turso

Turso handles backups automatically. For manual exports:

```bash
# Export to SQL
turso db shell discord-forum-api ".dump" > backup.sql

# Restore (create new db and import)
turso db create discord-forum-api-restored
turso db shell discord-forum-api-restored < backup.sql
```

## Schema Overview

The database schema includes these main tables:

| Table | Purpose |
|-------|---------|
| `servers` | Discord server metadata |
| `channels` | Forum channel information |
| `threads` | Forum threads |
| `messages` | Thread messages |
| `users` | Discord user profiles |
| `reactions` | Message reactions |
| `tags` | Thread tags |

Explore the full schema in `packages/db/src/schema.ts`.

## Troubleshooting

### "Database is locked"

SQLite can lock if multiple processes access it:

- Ensure only one bot instance is running
- Check for zombie processes: `ps aux | grep node`
- Increase busy timeout (if custom client)

### "Table does not exist"

Schema wasn't pushed:

```bash
pnpm db:push
```

### Turso connection errors

- Verify `TURSO_DATABASE_URL` format: `libsql://...`
- Check token hasn't expired: `turso db tokens create <name>`
- Ensure network allows outbound HTTPS

### Slow queries

- Check indexes exist (schema includes them by default)
- Use `EXPLAIN QUERY PLAN` in Drizzle Studio
- Consider pagination for large result sets
