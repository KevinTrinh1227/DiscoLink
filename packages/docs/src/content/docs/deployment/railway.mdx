---
title: Railway Deployment
description: Deploy Discord Forum API to Railway
---

import { Steps, Aside, Tabs, TabItem } from '@astrojs/starlight/components';

Railway is the easiest way to deploy both the bot and API together.

## Why Railway?

- **Supports long-running processes** (perfect for the Discord bot)
- **$5 free credit monthly** (no credit card required to start)
- **One-click database hosting**
- **Automatic deploys from GitHub**
- **Simple environment variable management**

## Prerequisites

- [Railway account](https://railway.app/) (free)
- GitHub repository with your code
- Discord bot token (from [Discord Setup](/guides/discord-bot-setup))

## Quick Deploy

<Steps>

1. **Go to Railway Dashboard**

   Visit [railway.app](https://railway.app/) and sign in with GitHub.

2. **Create New Project**

   Click "New Project" → "Deploy from GitHub repo"

3. **Select Repository**

   Choose your `discord-forum-api` repository.

4. **Railway auto-detects the project**

   It will detect the monorepo structure.

</Steps>

## Project Structure

You'll create two services on Railway:

```
Railway Project
├── discord-bot (Service)    # packages/bot
├── discord-api (Service)    # packages/api
└── PostgreSQL (Optional)    # Database
```

## Deploying the Bot

<Steps>

1. **Add New Service**

   In your Railway project, click "New Service" → "GitHub Repo"

2. **Configure Service**

   | Setting | Value |
   |---------|-------|
   | **Name** | `discord-bot` |
   | **Root Directory** | `packages/bot` |
   | **Build Command** | `cd ../.. && pnpm install && pnpm build` |
   | **Start Command** | `node dist/index.js` |

3. **Add Environment Variables**

   Click the service → "Variables" tab:

   ```env
   DISCORD_TOKEN=your_bot_token
   DISCORD_CLIENT_ID=your_client_id
   DATABASE_TYPE=turso
   TURSO_DATABASE_URL=libsql://your-db.turso.io
   TURSO_AUTH_TOKEN=your_token
   NODE_ENV=production
   ```

4. **Deploy**

   Railway will automatically deploy when you add variables.

</Steps>

## Deploying the API

<Steps>

1. **Add Another Service**

   Click "New Service" → "GitHub Repo" (same repo)

2. **Configure Service**

   | Setting | Value |
   |---------|-------|
   | **Name** | `discord-api` |
   | **Root Directory** | `packages/api` |
   | **Build Command** | `cd ../.. && pnpm install && pnpm build` |
   | **Start Command** | `node dist/index.js` |

3. **Add Environment Variables**

   ```env
   DATABASE_TYPE=turso
   TURSO_DATABASE_URL=libsql://your-db.turso.io
   TURSO_AUTH_TOKEN=your_token
   API_PORT=3000
   CORS_ORIGIN=https://yourdomain.com
   NODE_ENV=production
   ```

4. **Generate Domain**

   Click service → "Settings" → "Generate Domain"

   You'll get a URL like `discord-api-production.up.railway.app`

</Steps>

## Using Railway's PostgreSQL

Instead of Turso, you can use Railway's PostgreSQL:

<Steps>

1. **Add PostgreSQL**

   In your project, click "New" → "Database" → "PostgreSQL"

2. **Copy Connection String**

   Click PostgreSQL → "Variables" → Copy `DATABASE_URL`

3. **Update Service Variables**

   ```env
   DATABASE_TYPE=postgres
   DATABASE_URL=${{Postgres.DATABASE_URL}}
   ```

   Using `${{Postgres.DATABASE_URL}}` references the variable from your Postgres service.

</Steps>

<Aside>
  PostgreSQL support requires updating the db package to use the PostgreSQL driver.
</Aside>

## Shared Variables

For variables used by both services, use Railway's shared variables:

<Steps>

1. Click project settings (gear icon)
2. Go to "Shared Variables"
3. Add common variables:

   ```env
   DATABASE_TYPE=turso
   TURSO_DATABASE_URL=libsql://your-db.turso.io
   TURSO_AUTH_TOKEN=your_token
   ```

4. Reference in services with `${{shared.VARIABLE_NAME}}`

</Steps>

## Custom Domain

<Steps>

1. Click your API service
2. Go to "Settings" → "Networking"
3. Add custom domain (e.g., `api.yourdomain.com`)
4. Configure DNS as shown
5. SSL is automatic

</Steps>

## Nixpacks Configuration

Railway uses Nixpacks for builds. Create `nixpacks.toml` in package roots for custom configuration:

```toml
# packages/bot/nixpacks.toml
[phases.setup]
nixPkgs = ['nodejs_20', 'pnpm']

[phases.install]
cmds = ['cd ../.. && pnpm install']

[phases.build]
cmds = ['cd ../.. && pnpm build']

[start]
cmd = 'node dist/index.js'
```

## Monitoring

### Logs

View logs in real-time:

1. Click service
2. Go to "Deployments" tab
3. Click a deployment to see logs

### Metrics

Railway shows:

- CPU usage
- Memory usage
- Network traffic
- Request counts

### Alerts

Set up alerts for:

- Service crashes
- High resource usage
- Failed deployments

## railway.json (Optional)

For more control, create `railway.json`:

```json
{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "NIXPACKS",
    "buildCommand": "cd ../.. && pnpm install && pnpm build"
  },
  "deploy": {
    "startCommand": "node dist/index.js",
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 10
  }
}
```

## Pricing

| Plan | Price | Includes |
|------|-------|----------|
| **Hobby** | $5/month | $5 credit, basic resources |
| **Pro** | $20/month | Higher limits, team features |

**Typical usage for Discord Forum API:**

| Resource | Estimated Usage | Cost |
|----------|-----------------|------|
| Bot service | ~$2-3/month | Low CPU/memory |
| API service | ~$2-5/month | Depends on traffic |
| PostgreSQL | ~$5-10/month | If using Railway's DB |

<Aside type="tip">
  Start with the Hobby plan. The $5 credit is enough for light usage. You can upgrade later.
</Aside>

## Troubleshooting

### Build Fails

1. Check build logs for errors
2. Verify Root Directory is correct
3. Ensure dependencies install properly
4. Check Node.js version compatibility

### Bot Disconnects

1. Check `DISCORD_TOKEN` is correct
2. Verify bot has necessary intents
3. Check logs for error messages
4. Railway restarts failed services automatically

### API Returns 500

1. Check environment variables
2. Verify database connection
3. Review API logs
4. Test database query locally

### Out of Memory

1. Upgrade to larger instance
2. Add memory limits to start command
3. Optimize database queries
4. Add pagination to large responses

## Example Complete Setup

**Project structure:**

```
Railway Project: discord-forum-api
├── Service: discord-bot
│   ├── Root: packages/bot
│   ├── Build: cd ../.. && pnpm install && pnpm build
│   ├── Start: node dist/index.js
│   └── Variables:
│       ├── DISCORD_TOKEN=***
│       ├── DISCORD_CLIENT_ID=***
│       └── ${{shared variables}}
│
├── Service: discord-api
│   ├── Root: packages/api
│   ├── Build: cd ../.. && pnpm install && pnpm build
│   ├── Start: node dist/index.js
│   ├── Domain: api.yourdomain.com
│   └── Variables:
│       ├── API_PORT=3000
│       ├── CORS_ORIGIN=https://yourdomain.com
│       └── ${{shared variables}}
│
└── Shared Variables:
    ├── DATABASE_TYPE=turso
    ├── TURSO_DATABASE_URL=libsql://...
    ├── TURSO_AUTH_TOKEN=***
    └── NODE_ENV=production
```
