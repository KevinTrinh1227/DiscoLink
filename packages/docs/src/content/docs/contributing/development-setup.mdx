---
title: Development Setup
description: Set up your local development environment for contributing
---

import { Steps, Aside, Tabs, TabItem } from '@astrojs/starlight/components';

Set up your local environment to contribute to Discord Forum API.

## Prerequisites

| Tool | Version | Install |
|------|---------|---------|
| Node.js | 20.x+ | [nodejs.org](https://nodejs.org) |
| pnpm | 9.x+ | `npm install -g pnpm` |
| Git | Any | [git-scm.com](https://git-scm.com) |
| Discord Bot | - | [Discord Setup](/guides/discord-bot-setup) |

## Quick Setup

<Steps>

1. **Fork the repository**

   Click "Fork" on [GitHub](https://github.com/KevinTrinh1227/discord-forum-api)

2. **Clone your fork**

   ```bash
   git clone https://github.com/YOUR_USERNAME/discord-forum-api.git
   cd discord-forum-api
   ```

3. **Install dependencies**

   ```bash
   pnpm install
   ```

4. **Configure environment**

   ```bash
   cp .env.example .env
   # Edit .env with your Discord credentials
   ```

5. **Initialize database**

   ```bash
   pnpm db:push
   ```

6. **Start development**

   ```bash
   pnpm dev
   ```

</Steps>

## Project Structure

```
discord-forum-api/
├── packages/
│   ├── api/              # REST API (Hono.js)
│   │   ├── src/
│   │   │   ├── routes/   # API endpoints
│   │   │   ├── middleware/
│   │   │   └── lib/
│   │   └── package.json
│   │
│   ├── bot/              # Discord bot (discord.js)
│   │   ├── src/
│   │   │   ├── events/   # Discord event handlers
│   │   │   ├── commands/ # Slash commands
│   │   │   ├── sync/     # Sync logic
│   │   │   └── lib/
│   │   └── package.json
│   │
│   ├── db/               # Database (Drizzle ORM)
│   │   ├── src/
│   │   │   ├── schema.ts # Database schema
│   │   │   ├── client.ts # DB client
│   │   │   └── helpers.ts
│   │   └── package.json
│   │
│   └── docs/             # Documentation (Starlight)
│       ├── src/
│       │   └── content/docs/
│       └── package.json
│
├── docs/                 # Legacy markdown docs
├── turbo.json            # Turborepo config
├── tsconfig.json         # Base TypeScript config
└── package.json          # Root workspace
```

## Development Commands

### All Packages

| Command | Description |
|---------|-------------|
| `pnpm dev` | Start all packages in watch mode |
| `pnpm build` | Build all packages |
| `pnpm lint` | Run ESLint |
| `pnpm lint:fix` | Fix auto-fixable lint issues |
| `pnpm typecheck` | Run TypeScript type checking |
| `pnpm test` | Run all tests |

### Database

| Command | Description |
|---------|-------------|
| `pnpm db:push` | Push schema to database |
| `pnpm db:generate` | Generate migrations |
| `pnpm db:migrate` | Run migrations |
| `pnpm db:studio` | Open Drizzle Studio GUI |

### Documentation

| Command | Description |
|---------|-------------|
| `pnpm docs:dev` | Start docs dev server |
| `pnpm docs:build` | Build docs site |
| `pnpm docs:preview` | Preview built docs |

### Single Package

```bash
# Run command in specific package
pnpm --filter @discordlink/api dev
pnpm --filter @discordlink/bot build
pnpm --filter @discordlink/db test
```

## IDE Setup

### VS Code

Recommended extensions:

```json
// .vscode/extensions.json
{
  "recommendations": [
    "dbaeumer.vscode-eslint",
    "esbenp.prettier-vscode",
    "astro-build.astro-vscode",
    "bradlc.vscode-tailwindcss"
  ]
}
```

Settings:

```json
// .vscode/settings.json
{
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": "explicit"
  },
  "typescript.tsdk": "node_modules/typescript/lib"
}
```

### Other Editors

- **WebStorm**: Built-in TypeScript support
- **Neovim**: Use `typescript-language-server`
- **Sublime Text**: LSP + TypeScript plugin

## Testing

### Run All Tests

```bash
pnpm test
```

### Run Specific Tests

```bash
# By package
pnpm --filter @discordlink/api test

# By pattern
pnpm test -- --grep "threads"

# Watch mode
pnpm test -- --watch
```

### Test Coverage

```bash
pnpm test:cov
```

### Writing Tests

Tests use [Vitest](https://vitest.dev/). Example:

```typescript
// packages/api/src/routes/threads.test.ts
import { describe, it, expect, beforeEach } from 'vitest';
import { app } from '../index';

describe('GET /api/threads', () => {
  it('returns threads list', async () => {
    const res = await app.request('/api/threads?serverId=123');
    expect(res.status).toBe(200);

    const data = await res.json();
    expect(data).toHaveProperty('threads');
    expect(Array.isArray(data.threads)).toBe(true);
  });

  it('requires serverId parameter', async () => {
    const res = await app.request('/api/threads');
    expect(res.status).toBe(400);
  });
});
```

## Database Development

### Drizzle Studio

Explore your database visually:

```bash
pnpm db:studio
```

Opens at `http://localhost:4983`

### Schema Changes

<Steps>

1. Modify `packages/db/src/schema.ts`

2. Generate migration:
   ```bash
   pnpm db:generate
   ```

3. Review generated SQL in `packages/db/drizzle/`

4. Apply migration:
   ```bash
   pnpm db:migrate
   ```

   Or for development, push directly:
   ```bash
   pnpm db:push
   ```

</Steps>

### Seeding Data

Create test data for development:

```typescript
// packages/db/src/seed.ts
import { db } from './client';
import { servers, threads, messages } from './schema';

async function seed() {
  // Insert test server
  await db.insert(servers).values({
    id: '123456789',
    name: 'Test Server',
    icon: null,
  });

  // Insert test thread
  await db.insert(threads).values({
    id: '111222333',
    serverId: '123456789',
    title: 'Test Thread',
    // ...
  });

  console.log('Seed complete!');
}

seed();
```

Run with:

```bash
pnpm --filter @discordlink/db tsx src/seed.ts
```

## Environment Variables

### Required

```env
DISCORD_TOKEN=your_bot_token
DISCORD_CLIENT_ID=your_client_id
```

### Optional

```env
# Database (default: sqlite)
DATABASE_TYPE=sqlite
DATABASE_PATH=./data/discord-forum.db

# For Turso
DATABASE_TYPE=turso
TURSO_DATABASE_URL=libsql://...
TURSO_AUTH_TOKEN=...

# API
API_PORT=3000
CORS_ORIGIN=http://localhost:3000

# Development
LOG_LEVEL=debug
SYNC_BOT_MESSAGES=true
```

## Debugging

### VS Code Debugger

Create `.vscode/launch.json`:

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Debug API",
      "type": "node",
      "request": "launch",
      "runtimeExecutable": "pnpm",
      "runtimeArgs": ["--filter", "@discordlink/api", "dev"],
      "cwd": "${workspaceFolder}",
      "console": "integratedTerminal"
    },
    {
      "name": "Debug Bot",
      "type": "node",
      "request": "launch",
      "runtimeExecutable": "pnpm",
      "runtimeArgs": ["--filter", "@discordlink/bot", "dev"],
      "cwd": "${workspaceFolder}",
      "console": "integratedTerminal"
    }
  ]
}
```

### Console Logging

```typescript
// Use structured logging
console.log('[DEBUG]', { action: 'sync', threadId: '123' });
```

### Inspecting Requests

```bash
# Use curl to test API
curl -v http://localhost:3000/api/threads?serverId=123

# Use httpie for nicer output
http localhost:3000/api/threads serverId==123
```

## Common Tasks

### Adding a New Endpoint

<Steps>

1. Create route file:
   ```typescript
   // packages/api/src/routes/my-route.ts
   import { Hono } from 'hono';

   export const myRoute = new Hono();

   myRoute.get('/', async (c) => {
     return c.json({ hello: 'world' });
   });
   ```

2. Register in main app:
   ```typescript
   // packages/api/src/index.ts
   import { myRoute } from './routes/my-route';

   app.route('/api/my-route', myRoute);
   ```

3. Add tests:
   ```typescript
   // packages/api/src/routes/my-route.test.ts
   ```

</Steps>

### Adding a Discord Event Handler

<Steps>

1. Create event file:
   ```typescript
   // packages/bot/src/events/myEvent.ts
   import { Events } from 'discord.js';
   import type { Client } from 'discord.js';

   export function register(client: Client) {
     client.on(Events.MessageCreate, async (message) => {
       // Handle event
     });
   }
   ```

2. Register in bot:
   ```typescript
   // packages/bot/src/index.ts
   import * as myEvent from './events/myEvent';

   myEvent.register(client);
   ```

</Steps>

## Troubleshooting

### "Module not found" Errors

```bash
# Rebuild packages
pnpm build

# Or clean and reinstall
rm -rf node_modules packages/*/node_modules
pnpm install
```

### TypeScript Errors

```bash
# Check types across all packages
pnpm typecheck
```

### Database Issues

```bash
# Reset database (development only!)
rm -f data/discord-forum.db
pnpm db:push
```

### Bot Not Connecting

1. Verify token in `.env`
2. Check intents in Discord Developer Portal
3. Review console output for errors
