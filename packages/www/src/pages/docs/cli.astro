---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';

const initConfigExample = `{
  "serverId": "123456789",
  "apiUrl": "http://localhost:3000",
  "template": "faq",
  "output": "./dist",
  "build": {
    "clean": true,
    "generateSitemap": true,
    "generateRss": true
  }
}`;

const vercelExample = `# vercel.json
{
  "buildCommand": "discordlink export --server YOUR_ID",
  "outputDirectory": "dist"
}`;

const ghActionsExample = `# .github/workflows/deploy.yml
name: Deploy
on:
  push:
    branches: [main]
  schedule:
    - cron: '0 */6 * * *'  # Rebuild every 6 hours

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
      - run: npm install -g @discordlink/cli
      - run: discordlink export --server \${{ secrets.SERVER_ID }} --api-url \${{ secrets.API_URL }}
      - uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: \${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist`;

const fullConfigExample = `{
  "serverId": "123456789",          // Required
  "apiUrl": "http://localhost:3000", // API endpoint
  "template": "faq",                 // Default template
  "output": "./dist",                // Output directory
  "build": {
    "clean": true,                   // Clean before build
    "generateSitemap": true,         // Generate sitemap.xml
    "generateRss": true              // Generate feed.xml
  },
  "seo": {
    "titleSuffix": " - My FAQ",      // Append to page titles
    "defaultDescription": "..."      // Default meta description
  }
}`;
---

<BaseLayout title="CLI Reference - DiscordLink">
  <Header />

  <main>
    <div class="container">
      <nav class="breadcrumb">
        <a href="/docs">Docs</a> / <span>CLI Reference</span>
      </nav>

      <header class="page-header">
        <h1>CLI Reference</h1>
        <p>Command-line tool for exporting Discord content to static files.</p>
      </header>

      <section class="installation">
        <h2>Installation</h2>
        <pre><code># Install globally
npm install -g @discordlink/cli

# Or use npx
npx @discordlink/cli export --help</code></pre>
      </section>

      <section class="commands">
        <h2>Commands</h2>

        <div class="command">
          <h3>discordlink init</h3>
          <p>Initialize a new DiscordLink project with interactive prompts.</p>
          <pre><code>discordlink init</code></pre>
          <p>Creates <code>discordlink.config.json</code> with your configuration:</p>
          <pre><code set:text={initConfigExample} /></pre>
        </div>

        <div class="command">
          <h3>discordlink export</h3>
          <p>Export Discord content to static HTML files.</p>
          <pre><code>discordlink export [options]</code></pre>

          <h4>Options</h4>
          <table class="options-table">
            <thead>
              <tr>
                <th>Option</th>
                <th>Description</th>
                <th>Default</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>-s, --server &lt;id&gt;</code></td>
                <td>Server ID to export</td>
                <td>From config</td>
              </tr>
              <tr>
                <td><code>-t, --thread &lt;id&gt;</code></td>
                <td>Export single thread</td>
                <td>-</td>
              </tr>
              <tr>
                <td><code>-c, --channel &lt;id&gt;</code></td>
                <td>Export specific channel only</td>
                <td>-</td>
              </tr>
              <tr>
                <td><code>-o, --output &lt;dir&gt;</code></td>
                <td>Output directory</td>
                <td>./dist</td>
              </tr>
              <tr>
                <td><code>--template &lt;name&gt;</code></td>
                <td>Template: faq, changelog, kb, blog</td>
                <td>faq</td>
              </tr>
              <tr>
                <td><code>--base-url &lt;url&gt;</code></td>
                <td>Base URL for generated links</td>
                <td>-</td>
              </tr>
              <tr>
                <td><code>--api-url &lt;url&gt;</code></td>
                <td>DiscordLink API URL</td>
                <td>http://localhost:3000</td>
              </tr>
              <tr>
                <td><code>--clean</code></td>
                <td>Clean output directory first</td>
                <td>false</td>
              </tr>
            </tbody>
          </table>

          <h4>Examples</h4>
          <pre><code># Export entire server
discordlink export --server 123456789 --output ./dist

# Export with custom template
discordlink export --server 123456789 --template changelog

# Export single thread
discordlink export --thread 987654321

# Export with base URL for production
discordlink export --server 123456789 --base-url https://faq.example.com</code></pre>
        </div>

        <div class="command">
          <h3>discordlink sync</h3>
          <p>Verify API connection and show server status.</p>
          <pre><code>discordlink sync [options]</code></pre>

          <h4>Options</h4>
          <table class="options-table">
            <thead>
              <tr>
                <th>Option</th>
                <th>Description</th>
                <th>Default</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>-s, --server &lt;id&gt;</code></td>
                <td>Server ID to check</td>
                <td>From config</td>
              </tr>
              <tr>
                <td><code>--api-url &lt;url&gt;</code></td>
                <td>DiscordLink API URL</td>
                <td>http://localhost:3000</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <section class="output">
        <h2>Output Structure</h2>
        <p>After running <code>discordlink export</code>, you'll have:</p>
        <pre><code>dist/
├── index.html          # Main listing page
├── threads/
│   ├── how-to-auth.html
│   ├── getting-started.html
│   └── ...
├── sitemap.xml         # Sitemap for SEO
├── feed.xml            # RSS feed
└── robots.txt          # Robots.txt</code></pre>
      </section>

      <section class="deployment">
        <h2>Deployment</h2>
        <p>The output is static HTML that can be deployed anywhere:</p>

        <h3>Netlify</h3>
        <pre><code># netlify.toml
[build]
  command = "discordlink export --server YOUR_ID"
  publish = "dist"</code></pre>

        <h3>Vercel</h3>
        <pre><code set:text={vercelExample} /></pre>

        <h3>GitHub Pages</h3>
        <pre><code set:text={ghActionsExample} /></pre>
      </section>

      <section class="config">
        <h2>Configuration File</h2>
        <p>The <code>discordlink.config.json</code> file supports:</p>
        <pre><code set:text={fullConfigExample} /></pre>
      </section>
    </div>
  </main>

  <Footer />
</BaseLayout>

<style>
  main {
    padding-top: 120px;
    padding-bottom: 4rem;
  }
  .container {
    max-width: 900px;
    margin: 0 auto;
    padding: 0 2rem;
  }
  .breadcrumb {
    margin-bottom: 2rem;
    font-size: 0.9rem;
    color: var(--text-secondary);
  }
  .breadcrumb a {
    color: var(--text-secondary);
  }
  .breadcrumb a:hover {
    color: var(--accent);
  }
  .page-header {
    margin-bottom: 3rem;
  }
  .page-header h1 {
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
  }
  .page-header p {
    color: var(--text-secondary);
    font-size: 1.1rem;
  }

  section {
    margin-bottom: 3rem;
  }
  h2 {
    font-size: 1.5rem;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid var(--border);
  }
  h3 {
    font-size: 1.2rem;
    margin: 2rem 0 0.75rem;
    color: var(--accent);
  }
  h4 {
    font-size: 1rem;
    margin: 1.5rem 0 0.75rem;
    color: var(--text-secondary);
  }

  pre {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 1rem;
    overflow-x: auto;
    font-size: 0.9rem;
    margin: 1rem 0;
  }
  code {
    color: var(--text);
  }
  p code {
    background: var(--bg-tertiary);
    padding: 0.15rem 0.4rem;
    border-radius: 4px;
    font-size: 0.9em;
  }

  .command {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
  }
  .command h3 {
    margin-top: 0;
  }
  .command > p:first-of-type {
    color: var(--text-secondary);
    margin-bottom: 1rem;
  }

  .options-table {
    width: 100%;
    border-collapse: collapse;
    margin: 1rem 0;
  }
  .options-table th,
  .options-table td {
    padding: 0.75rem;
    text-align: left;
    border-bottom: 1px solid var(--border);
  }
  .options-table th {
    font-weight: 600;
    color: var(--text-secondary);
    font-size: 0.9rem;
  }
  .options-table td code {
    background: var(--bg-tertiary);
    padding: 0.15rem 0.4rem;
    border-radius: 4px;
    font-size: 0.85rem;
  }
</style>
